## API Трекера привычек

**Backend-часть SPA веб-приложения для трекинга привычек.**

- Просмотр публичных привычек
- Просмотр и добавление своих привычек
- Напоминания в Telegram о заданных привычках

### Стек технологий:

- `Python`
- `Django`
- `DRF`
- `Celery`
- `Celery-beat`
- `PostgreSQL`
- `Redis`

## Содержание

<details>
<summary>Инструкция по развертыванию проекта</summary>

#### 1. Установите зависимости из файла pyproject.toml

#### 2. Настройте переменные окружения:

1. Создайте файл `.env` в корневой директории
2. Скопируйте в него содержимое файла `.env_example` и подставьте свои значения

</details>

<details>
<summary>Инструкция по развертыванию проекта с использованием Docker</summary>

#### Запустите команду, для сборки контейнеров в docker-compose

```
docker-compose up -d --build
```

Чтобы попасть в контейнер с приложением и выполнять в нем команды, введите

```
docker exec -it <'id контейнера' или имя 'drf-app'> bash
```
</details>

<details>
<summary>Использование</summary>

#### 1. Административная панель:

Для доступа к админке создайте суперпользователя

1. Для создания суперпользователя (админа) выполните команду
    ```
    python manage.py csu
    ```
   E-mail и пароль суперпользоветеля для входа в админку вы можете посмотреть в
   файле `/users/management/commands/csu.py`. При желании, вы можете задать свои e-mail и пароль

2. Откройте административную панель по адресу http://localhost:8000/admin/ и введите e-mail и пароль суперпользователя

#### 2. Настройка уведомлений в Telegram:

1. Для отправки уведомлений у пользователя должно быть заполнено поле `chat_id`. Значение - id чата в Telegram.
2. Поле можно заполнить:
    - При регистрации.
      Для этого перейдите по адресу http://127.0.0.1:8000/users/register/ и заполните все поля. Пример заполнения в
      формате `json`:
         ```
         {
             "email": "my_mail@mail.com",
             "password": "my_password",
             "chat_id": "000000000"
         }
         ```
    - В административной панели.
      Заполните нужное поле при создании или редактировании пользователя

#### 3. Создание привычки:

1. Получите `Bearer token` созданного пользователя по адресу http://127.0.0.1:8000/users/login/
2. Для создания привычки перейдите по адресу http://127.0.0.1:8000/habits/
3. Укажите токен в заголовке запроса
4. Укажите поля в теле запроса в формате `json` и отправьте `POST` запрос:
      ```
      {
          "place": "Дома",
          "time": "22:00",
          "action": "Почистить зубы",
          "is_enjoyable": false, # По умолчанию False
          "periodicity": 1, # Периодичность привычки (от 1 до 7), по умолчанию 1
          "treat": "Лечь спать",
          "duration": "00:01:00",
          "is_public": true # По умолчанию False
      }
      ```
    - Поле `duration` можно заполнять в формате "00:01:00" или числом "60", но не более 2 минут (120 секунд)

</details>

<details>
<summary>Описание и запуск периодических задач</summary>

#### 1. Запуск отслеживания периодических задач:

Для запуска отслеживания периодических задач (в данном случае для отправки уведомлений в Телеграм)
нужно запустить "celery worker" и "celery beat":

`celery -A config worker -l INFO` (для Windows нужно добавить `-P eventlet`)

`celery -A config beat -l INFO -S django`

#### 2. Отправка уведомлений в Telegram

Задача для отправки уведомлений формируется автоматически при создании и обновлении привычки. Уведомление отправляется с
периодичностью равной той, что указана у привычки в поле `periodicity`

</details>

## Документация

Документация по API доступна по адресам:

- Swagger - http://127.0.0.1:8000/docs/
- Redoc - http://127.0.0.1:8000/redoc/
